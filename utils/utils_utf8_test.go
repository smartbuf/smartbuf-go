package utils

import (
	"github.com/stretchr/testify/assert"
	"reflect"
	"testing"
)

var utf8Cases = [][]string{
	{
		"我能吞下玻璃而不伤身体。",
		"\xe6\x88\x91\xe8\x83\xbd\xe5\x90\x9e\xe4\xb8\x8b\xe7\x8e\xbb\xe7\x92\x83\xe8\x80\x8c\xe4\xb8\x8d\xe4\xbc\xa4\xe8\xba\xab\xe4\xbd\x93\xe3\x80\x82",
	},
	{
		"我能吞下玻璃而不傷身體。",
		"\xe6\x88\x91\xe8\x83\xbd\xe5\x90\x9e\xe4\xb8\x8b\xe7\x8e\xbb\xe7\x92\x83\xe8\x80\x8c\xe4\xb8\x8d\xe5\x82\xb7\xe8\xba\xab\xe9\xab\x94\xe3\x80\x82",
	},
	{
		"ನಿತ್ಯವೂ",
		"\xe0\xb2\xa8\xe0\xb2\xbf\xe0\xb2\xa4\xe0\xb3\x8d\xe0\xb2\xaf\xe0\xb2\xb5\xe0\xb3\x82",
	},
	{
		"私はガラスを食べられます",
		"\xe7\xa7\x81\xe3\x81\xaf\xe3\x82\xac\xe3\x83\xa9\xe3\x82\xb9\xe3\x82\x92\xe9\xa3\x9f\xe3\x81\xb9\xe3\x82\x89\xe3\x82\x8c\xe3\x81\xbe\xe3\x81\x99",
	},
	{
		"나는 유리를 먹을 수 있어요",
		"\xeb\x82\x98\xeb\x8a\x94\x20\xec\x9c\xa0\xeb\xa6\xac\xeb\xa5\xbc\x20\xeb\xa8\xb9\xec\x9d\x84\x20\xec\x88\x98\x20\xec\x9e\x88\xec\x96\xb4\xec\x9a\x94",
	},
	{
		"τοῦ Ὀδυσσέα Ἐλύτη",
		"\xcf\x84\xce\xbf\xe1\xbf\xa6\x20\xe1\xbd\x88\xce\xb4\xcf\x85\xcf\x83\xcf\x83\xce\xad\xce\xb1\x20\xe1\xbc\x98\xce\xbb\xcf\x8d\xcf\x84\xce\xb7",
	},
}

func TestUTF8(t *testing.T) {
	for _, item := range utf8Cases {
		str := item[0]
		tgt := []byte(item[1])
		encoded := EncodeUTF8(str)
		assert.True(t, reflect.DeepEqual(tgt, encoded))
		assert.True(t, DecodeUTF8(encoded) == str)
	}

	var str = "hello 世界"
	var buf [1024]byte
	n := EncodeUTF8ToBuf(str, buf[:])
	assert.True(t, DecodeUTF8(buf[:n]) == str)
}
